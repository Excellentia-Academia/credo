<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Module d'√âpellation Vocale avec Scores</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    @keyframes gradientAnimation {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .container {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(12px);
      max-width: 800px;
      width: 100%;
      text-align: center;
      animation: fadeIn 1.2s ease;
      margin-bottom: 20px;
    }
    @keyframes fadeIn { from {opacity: 0; transform: translateY(15px);} to {opacity: 1; transform: translateY(0);} }

    h1 { 
      font-weight: 800; 
      margin-bottom: 20px; 
      font-size: 2.2rem; 
      text-shadow: 0 3px 8px rgba(0, 0, 0, 0.3); 
      background: linear-gradient(90deg, #fff, #6a11cb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Section profil */
    .profile-section {
      background: rgba(255, 255, 255, 0.15);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      text-align: left;
    }
    
    .profile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .total-score {
      font-size: 2rem;
      font-weight: bold;
      color: #00e676;
      text-shadow: 0 0 10px rgba(0, 230, 118, 0.5);
    }
    
    /* Barre de stats */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.2);
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    #wordDisplay { 
      font-size: 2.5rem; 
      font-weight: bold; 
      letter-spacing: 0.15em; 
      margin: 20px 0; 
      min-height: 60px;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .progress-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
    }
    
    #progressBar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    #progressFill {
      height: 100%;
      background: linear-gradient(90deg, #00e676, #00c853);
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .page-controls {
      display: grid; 
      grid-template-columns: 1fr auto 1fr; 
      gap: 15px; 
      align-items: center; 
      margin: 20px 0;
    }
    
    .page-controls button, .page-controls select {
      padding: 12px 20px; 
      border-radius: 10px; 
      border: none; 
      font-size: 1rem; 
      font-weight: 600;
      background: #fff; 
      color: #2575fc;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .page-controls button:hover { 
      background: #2575fc; 
      color: #fff; 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 117, 252, 0.4); 
    }
    
    .page-controls select {
      padding: 11px 20px;
    }
    
    input[type="text"] {
      font-size: 1.3rem; 
      padding: 16px 20px; 
      border-radius: 12px; 
      border: 2px solid transparent; 
      width: 100%; 
      margin: 20px 0;
      background-color: rgba(255, 255, 255, 0.95); 
      color: #333; 
      outline: none; 
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    input[type="text"]:focus { 
      border-color: #2575fc;
      box-shadow: 0 0 20px rgba(37, 117, 252, 0.3); 
      transform: translateY(-2px);
    }
    
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 25px 0;
    }
    
    .controls-grid button {
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.95);
      color: #2575fc;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .controls-grid button:hover {
      background: #2575fc;
      color: #fff;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(37, 117, 252, 0.4);
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    
    #btnSaveScore {
      background: linear-gradient(135deg, #00e676, #00c853);
      color: white;
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    #btnNewSession {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    #message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      min-height: 50px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.1);
    }
    
    .score-history {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      margin-top: 25px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .score-history h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #00e676;
    }
    
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .history-score {
      font-weight: bold;
      color: #00e676;
    }
    
    .history-date {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .hidden {
      display: none;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .controls-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .page-controls {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      #wordDisplay {
        font-size: 2rem;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Section Profil -->
    <div class="profile-section">
      <div class="profile-header">
        <div class="user-info">
          <div class="avatar" id="userAvatar">JD</div>
          <div>
            <h2 id="userName">Jean Dupont</h2>
            <p id="userLevel">Niveau: D√©butant</p>
          </div>
        </div>
        <div class="total-score" id="totalScore">0</div>
      </div>
      <div class="stats-bar" id="globalStats">
        <!-- Rempli par JavaScript -->
      </div>
    </div>
    
    <h1>üéØ Exercice d'√âpellation Vocale</h1>
    
    <!-- Contr√¥les de pagination -->
    <div class="page-controls">
      <button id="btnPrevPage" title="Page pr√©c√©dente">‚üµ Page Pr√©c√©dente</button>
      <div>
        Page <select id="pageSelect"></select><span id="totalPagesLabel"></span>
      </div>
      <button id="btnNextPage" title="Page suivante">Page Suivante ‚ü∂</button>
    </div>
    
    <!-- Barre de progression -->
    <div class="progress-section">
      <div id="progress">Question ‚Äî / 10 (page ‚Äî)</div>
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
    </div>
    
    <!-- Affichage du mot -->
    <div id="wordDisplay">Mot √† √©couter...</div>
    
    <!-- Zone de saisie -->
    <input type="text" id="answer" placeholder="√âcris le mot que tu as entendu..." 
           autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    
    <!-- Contr√¥les principaux -->
    <div class="controls-grid">
      <button id="btnPlay">‚ñ∂Ô∏è Jouer</button>
      <button id="btnSlow">üê¢ Ralentir</button>
      <button id="btnFast">üêá Acc√©l√©rer</button>
      <button id="btnRepeat">üîÅ R√©p√©ter</button>
      <button id="btnSkip">‚è≠ Passer</button>
      <button id="btnHint">üí° Indice</button>
    </div>
    
    <!-- Boutons d'action -->
    <div class="action-buttons">
      <button id="btnSaveScore">üíæ Enregistrer Score</button>
      <button id="btnNewSession">üîÑ Nouvelle Session</button>
    </div>
    
    <!-- Messages -->
    <div id="message">Pr√™t √† commencer ! Cliquez sur "Jouer" pour entendre le premier mot.</div>
    
    <!-- Historique des scores -->
    <div class="score-history" id="scoreHistory">
      <h3>üìä Historique des Scores</h3>
      <div id="historyList">
        <!-- Rempli par JavaScript -->
      </div>
    </div>
  </div>

  <script>
    // ==================== DONN√âES ====================
    const words = [
      "autel", "bataille", "ch√¥mage", "documentaire", "√©tang", "force", "gazouiller", "hache",
      "atome", "bibliographie", "crustac√©", "documentaliste", "√©rosion", "fantastique", "gam√®te", "hormone",
      "altercation", "bip√®de", "conductible", "dictionnaire", "√©tiquette", "fant√¥me", "gyn√©cologue", "herbivore",
      "acide", "bourgeon", "croquis", "d√©limitation", "√©cart", "format", "gentiment", "harmonieux",
      "amplitude", "bidonville", "cylindre", "descendre", "√©paisseur", "fonctionnement", "gabarit", "hypoth√®se",
      "analogie", "bissectrice", "contrebasse", "dent", "√©go√Øste", "fr√©tiller", "galanterie", "hypermarch√©",
      "ant√©c√©dent", "bissextile", "cyclope", "d√©soler", "√©quilat√©ral", "faillite", "g√¢chis", "humanit√©",
      "anaphore", "bouillir", "cellule", "dispara√Ætre", "expression", "facturation", "gangr√®ne", "hippopotame"
    ];

    // ==================== VARIABLES GLOBALES ====================
    const pageSize = 10;
    const totalPages = Math.ceil(words.length / pageSize);
    let currentPage = 1;
    let currentWordIndex = 0;
    let speechRate = 1;
    let score = 0;
    let correctAnswers = 0;
    let totalAttempts = 0;
    let currentStreak = 0;
    let bestStreak = 0;
    let sessionStartTime = null;
    let responseTimes = [];
    let exerciseCompleted = false;
    let userProfile = null;

    // ==================== √âL√âMENTS DOM ====================
    const elements = {
      wordDisplay: document.getElementById('wordDisplay'),
      answer: document.getElementById('answer'),
      message: document.getElementById('message'),
      progress: document.getElementById('progress'),
      progressFill: document.getElementById('progressFill'),
      pageSelect: document.getElementById('pageSelect'),
      totalPagesLabel: document.getElementById('totalPagesLabel'),
      btnPrevPage: document.getElementById('btnPrevPage'),
      btnNextPage: document.getElementById('btnNextPage'),
      btnPlay: document.getElementById('btnPlay'),
      btnSlow: document.getElementById('btnSlow'),
      btnFast: document.getElementById('btnFast'),
      btnRepeat: document.getElementById('btnRepeat'),
      btnSkip: document.getElementById('btnSkip'),
      btnHint: document.getElementById('btnHint'),
      btnSaveScore: document.getElementById('btnSaveScore'),
      btnNewSession: document.getElementById('btnNewSession'),
      totalScore: document.getElementById('totalScore'),
      globalStats: document.getElementById('globalStats'),
      historyList: document.getElementById('historyList'),
      userName: document.getElementById('userName'),
      userLevel: document.getElementById('userLevel'),
      userAvatar: document.getElementById('userAvatar')
    };

    // ==================== INITIALISATION ====================
    function init() {
      loadUserProfile();
      initPageSelect();
      updateGlobalStats();
      loadScoreHistory();
      startNewSession();
      
      // √âv√©nements
      setupEventListeners();
    }

    function loadUserProfile() {
      // Charger depuis localStorage ou cr√©er un profil par d√©faut
      const savedProfile = localStorage.getItem('spellingProfile');
      if (savedProfile) {
        userProfile = JSON.parse(savedProfile);
      } else {
        userProfile = {
          name: "Jean Dupont",
          totalScore: 0,
          sessions: 0,
          totalCorrect: 0,
          totalAttempts: 0,
          bestScore: 0,
          bestStreak: 0,
          level: "D√©butant",
          joinDate: new Date().toISOString()
        };
        saveProfile();
      }
      
      // Mettre √† jour l'affichage du profil
      elements.userName.textContent = userProfile.name;
      elements.userLevel.textContent = `Niveau: ${userProfile.level}`;
      elements.totalScore.textContent = userProfile.totalScore;
      elements.userAvatar.textContent = userProfile.name.substring(0, 2).toUpperCase();
    }

    function saveProfile() {
      localStorage.setItem('spellingProfile', JSON.stringify(userProfile));
    }

    // ==================== GESTION DES PAGES ====================
    function initPageSelect() {
      elements.pageSelect.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `Page ${i}`;
        elements.pageSelect.appendChild(option);
      }
      elements.totalPagesLabel.textContent = ` / ${totalPages}`;
    }

    function pageStartIndex(page) {
      return (page - 1) * pageSize;
    }

    function pageEndIndex(page) {
      return Math.min(page * pageSize - 1, words.length - 1);
    }

    function updateProgress() {
      const pageStart = pageStartIndex(currentPage);
      const pageEnd = pageEndIndex(currentPage);
      const position = currentWordIndex - pageStart + 1;
      const totalInPage = pageEnd - pageStart + 1;
      
      elements.progress.textContent = `Question ${position}/${totalInPage} (Page ${currentPage}/${totalPages})`;
      
      // Mettre √† jour la barre de progression
      const progressPercent = (position / totalInPage) * 100;
      elements.progressFill.style.width = `${progressPercent}%`;
    }

    function goToPage(page) {
      currentPage = Math.max(1, Math.min(totalPages, page));
      currentWordIndex = pageStartIndex(currentPage);
      elements.pageSelect.value = currentPage;
      playWord();
    }

    // ==================== SYNTH√àSE VOCALE ====================
    function speakWord(word, rate = speechRate) {
      if (!window.speechSynthesis) {
        showMessage("La synth√®se vocale n'est pas support√©e par votre navigateur.", "error");
        return;
      }
      
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = 'fr-FR';
      utterance.rate = rate;
      utterance.volume = 1;
      window.speechSynthesis.speak(utterance);
    }

    // ==================== LOGIQUE DU JEU ====================
    function startNewSession() {
      score = 0;
      correctAnswers = 0;
      totalAttempts = 0;
      currentStreak = 0;
      responseTimes = [];
      exerciseCompleted = false;
      sessionStartTime = Date.now();
      elements.btnSaveScore.disabled = false;
      elements.btnSaveScore.textContent = 'üíæ Enregistrer Score';
      
      goToPage(1);
      showMessage("Nouvelle session d√©marr√©e ! Bonne chance !", "info");
    }

    function playWord() {
      if (exerciseCompleted) return;
      
      const word = words[currentWordIndex];
      elements.wordDisplay.textContent = '?'.repeat(word.length);
      speakWord(word);
      
      showMessage("√âcoutez attentivement puis √©crivez le mot", "info");
      elements.answer.value = '';
      elements.answer.disabled = false;
      elements.answer.focus();
      
      updateProgress();
      startResponseTimer();
    }

    function checkAnswer() {
      if (exerciseCompleted) return;
      
      const userAnswer = normalize(elements.answer.value);
      const correctAnswer = normalize(words[currentWordIndex]);
      const timeTaken = stopResponseTimer();
      
      totalAttempts++;
      
      if (userAnswer === correctAnswer) {
        handleCorrectAnswer(correctAnswer, timeTaken);
      } else {
        handleIncorrectAnswer(correctAnswer);
      }
      
      updateSessionStats();
    }

    function handleCorrectAnswer(correctAnswer, timeTaken) {
      const points = calculatePoints(correctAnswer.length, timeTaken, currentStreak);
      score += points;
      correctAnswers++;
      currentStreak++;
      bestStreak = Math.max(bestStreak, currentStreak);
      
      elements.wordDisplay.textContent = correctAnswer;
      showMessage(`‚úÖ Correct ! +${points} points (S√©rie: ${currentStreak})`, "success");
      
      elements.answer.disabled = true;
      setTimeout(nextWord, 1500);
    }

    function handleIncorrectAnswer(correctAnswer) {
      currentStreak = 0;
      showMessage("‚ùå Incorrect. √âcoutez l'orthographe...", "error");
      spellWord(correctAnswer);
    }

    function calculatePoints(wordLength, timeTaken, streak) {
      // Points de base selon la longueur
      let points = Math.min(wordLength * 3, 30);
      
      // Bonus de rapidit√©
      if (timeTaken < 3) points += 20;
      else if (timeTaken < 5) points += 15;
      else if (timeTaken < 8) points += 10;
      
      // Bonus de s√©rie
      if (streak >= 5) points += 10;
      if (streak >= 10) points += 15;
      
      return points;
    }

    function spellWord(word) {
      window.speechSynthesis.cancel();
      const letters = word.split('');
      let index = 0;
      
      function spellNext() {
        if (index < letters.length) {
          const utterance = new SpeechSynthesisUtterance(letters[index]);
          utterance.lang = 'fr-FR';
          utterance.rate = 0.5;
          utterance.onend = () => {
            index++;
            setTimeout(spellNext, 300);
          };
          window.speechSynthesis.speak(utterance);
        } else {
          showMessage("R√©essayez d'√©crire le mot", "info");
          elements.answer.value = '';
          elements.answer.focus();
          startResponseTimer();
        }
      }
      
      spellNext();
    }

    function nextWord() {
      const pageEnd = pageEndIndex(currentPage);
      if (currentWordIndex < pageEnd) {
        currentWordIndex++;
        playWord();
      } else {
        endExercise();
      }
    }

    function prevWord() {
      const pageStart = pageStartIndex(currentPage);
      if (currentWordIndex > pageStart) {
        currentWordIndex--;
        playWord();
      }
    }

    function endExercise() {
      exerciseCompleted = true;
      elements.answer.disabled = true;
      
      const sessionDuration = ((Date.now() - sessionStartTime) / 1000 / 60).toFixed(1);
      const accuracy = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
      
      showMessage(
        `üéâ Exercice termin√© ! Score: ${score} points | Pr√©cision: ${accuracy}% | Dur√©e: ${sessionDuration}min`,
        "success"
      );
    }

    // ==================== GESTION DU TEMPS ====================
    let responseStartTime = null;

    function startResponseTimer() {
      responseStartTime = Date.now();
    }

    function stopResponseTimer() {
      if (!responseStartTime) return 0;
      const timeTaken = (Date.now() - responseStartTime) / 1000;
      responseTimes.push(timeTaken);
      responseStartTime = null;
      return timeTaken;
    }

    // ==================== STATISTIQUES ====================
    function updateSessionStats() {
      // Mise √† jour en temps r√©el
      const accuracy = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
      
      // Mettre √† jour l'affichage global
      updateGlobalStats();
    }

    function updateGlobalStats() {
      const stats = [
        { value: score, label: 'SCORE ACTUEL', color: '#00e676' },
        { value: correctAnswers, label: 'R√âUSSIS', color: '#2575fc' },
        { value: `${totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0}%`, label: 'PR√âCISION', color: '#ffb300' },
        { value: currentStreak, label: 'S√âRIE', color: '#e91e63' }
      ];
      
      elements.globalStats.innerHTML = stats.map(stat => `
        <div class="stat-card">
          <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
          <div class="stat-label">${stat.label}</div>
        </div>
      `).join('');
    }

    // ==================== GESTION DES SCORES ====================
    function saveScore() {
      if (score === 0) {
        showMessage("Aucun score √† enregistrer", "warning");
        return;
      }
      
      const sessionData = {
        date: new Date().toISOString(),
        score: score,
        correctAnswers: correctAnswers,
        totalAttempts: totalAttempts,
        accuracy: Math.round((correctAnswers / totalAttempts) * 100),
        streak: bestStreak,
        page: currentPage,
        duration: ((Date.now() - sessionStartTime) / 1000).toFixed(0)
      };
      
      // Mettre √† jour le profil
      userProfile.totalScore += score;
      userProfile.sessions++;
      userProfile.totalCorrect += correctAnswers;
      userProfile.totalAttempts += totalAttempts;
      userProfile.bestScore = Math.max(userProfile.bestScore, score);
      userProfile.bestStreak = Math.max(userProfile.bestStreak, bestStreak);
      
      // Mettre √† jour le niveau
      updateUserLevel();
      
      // Sauvegarder le profil
      saveProfile();
      
      // Sauvegarder l'historique
      saveToHistory(sessionData);
      
      // Mettre √† jour l'affichage
      elements.totalScore.textContent = userProfile.totalScore;
      elements.btnSaveScore.disabled = true;
      elements.btnSaveScore.textContent = '‚úÖ Score Enregistr√©';
      
      showMessage(`Score enregistr√© avec succ√®s ! Total: ${userProfile.totalScore} points`, "success");
    }

    function updateUserLevel() {
      const total = userProfile.totalScore;
      if (total >= 5000) userProfile.level = "Expert";
      else if (total >= 2000) userProfile.level = "Avanc√©";
      else if (total >= 500) userProfile.level = "Interm√©diaire";
      else userProfile.level = "D√©butant";
      
      elements.userLevel.textContent = `Niveau: ${userProfile.level}`;
    }

    function saveToHistory(sessionData) {
      let history = JSON.parse(localStorage.getItem('spellingHistory') || '[]');
      history.unshift(sessionData);
      if (history.length > 20) history = history.slice(0, 20); // Garder seulement 20 entr√©es
      localStorage.setItem('spellingHistory', JSON.stringify(history));
      
      loadScoreHistory();
    }

    function loadScoreHistory() {
      const history = JSON.parse(localStorage.getItem('spellingHistory') || '[]');
      
      if (history.length === 0) {
        elements.historyList.innerHTML = '<p style="text-align: center; opacity: 0.7;">Aucun score enregistr√©</p>';
        return;
      }
      
      elements.historyList.innerHTML = history.map(session => `
        <div class="history-item">
          <div>
            <div class="history-score">${session.score} points</div>
            <div>${session.correctAnswers}/${session.totalAttempts} (${session.accuracy}%)</div>
          </div>
          <div class="history-date">${formatDate(session.date)}</div>
        </div>
      `).join('');
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleDateString('fr-FR', {
        day: '2-digit',
        month: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // ==================== UTILITAIRES ====================
    function normalize(str) {
      return str.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }

    function showMessage(text, type = 'info') {
      elements.message.textContent = text;
      elements.message.style.background = type === 'success' ? 'rgba(0, 230, 118, 0.2)' :
                                         type === 'error' ? 'rgba(255, 82, 82, 0.2)' :
                                         type === 'warning' ? 'rgba(255, 179, 0, 0.2)' :
                                         'rgba(255, 255, 255, 0.1)';
      elements.message.style.color = type === 'success' ? '#00e676' :
                                     type === 'error' ? '#ff5252' :
                                     type === 'warning' ? '#ffb300' : '#fff';
    }

    function giveHint() {
      if (exerciseCompleted) return;
      
      const word = words[currentWordIndex];
      const hintLength = Math.ceil(word.length / 2);
      const hint = word.substring(0, hintLength) + '_'.repeat(word.length - hintLength);
      
      elements.wordDisplay.textContent = hint;
      showMessage(`Indice: ${hint}`, "info");
      
      // P√©nalit√© de score pour l'indice
      score = Math.max(0, score - 10);
      updateGlobalStats();
    }

    // ==================== √âV√âNEMENTS ====================
    function setupEventListeners() {
      // Navigation
      elements.btnPrevPage.addEventListener('click', () => goToPage(currentPage - 1));
      elements.btnNextPage.addEventListener('click', () => goToPage(currentPage + 1));
      elements.pageSelect.addEventListener('change', (e) => goToPage(parseInt(e.target.value)));
      
      // Contr√¥les audio
      elements.btnPlay.addEventListener('click', playWord);
      elements.btnSlow.addEventListener('click', () => {
        speechRate = Math.max(0.5, speechRate - 0.25);
        playWord();
      });
      elements.btnFast.addEventListener('click', () => {
        speechRate = Math.min(2, speechRate + 0.25);
        playWord();
      });
      elements.btnRepeat.addEventListener('click', playWord);
      elements.btnSkip.addEventListener('click', nextWord);
      elements.btnHint.addEventListener('click', giveHint);
      
      // Actions
      elements.btnSaveScore.addEventListener('click', saveScore);
      elements.btnNewSession.addEventListener('click', startNewSession);
      
      // Saisie
      elements.answer.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') checkAnswer();
      });
      
      // Navigation clavier
      document.addEventListener('keydown', (e) => {
        if (e.key === ' ') {
          e.preventDefault();
          playWord();
        } else if (e.key === 'ArrowRight' && e.ctrlKey) {
          nextWord();
        } else if (e.key === 'ArrowLeft' && e.ctrlKey) {
          prevWord();
        }
      });
    }

    // ==================== D√âMARRAGE ====================
    window.addEventListener('load', init);
  </script>
</body>
</html>

